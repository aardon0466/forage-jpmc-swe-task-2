From 85a8f52073ed462da7228066ae59743f6209861a Mon Sep 17 00:00:00 2001
From: aardon0466 <aardon0466@floridapoly.edu>
Date: Fri, 12 Jul 2024 14:57:54 -0400
Subject: [PATCH] Update Graph.tsx

---
 src/Graph.tsx | 38 +++++++++++++++++++++++++-------------
 1 file changed, 25 insertions(+), 13 deletions(-)

diff --git a/src/Graph.tsx b/src/Graph.tsx
index 014f2d3..9f84738 100644
--- a/src/Graph.tsx
+++ b/src/Graph.tsx
@@ -34,21 +34,18 @@ class Graph extends Component<IProps, {}> {
     // Get element to attach the table from the DOM.
     const elem = document.getElementsByTagName('perspective-viewer')[0] as unknown as PerspectiveViewerElement;
 
-    elem.setAttribute('view','y,line');
-    elem.setAttribute('column-pivots','["stock"]');
-    elem.setAttribute('row-pivots','["timestamp"]');
-    elem.setAttribute('columns','["top_ask_price"]');
-    elem.setAttribute('aggregates',`
-        {"stock":"distinct count",
-        "top_ask_price":"avg",
-        "top_bid_price":"avg",
-        "timestamp":"distinct count"}`);
-
     const schema = {
-      stock: 'string',
+      /**stock: 'string',
       top_ask_price: 'float',
       top_bid_price: 'float',
+      timestamp: 'date',*/
+      price_abc: 'float',
+      price_def: 'float',
+      ratio: 'float',
       timestamp: 'date',
+      upper_bound: 'float',
+      lower_bound: 'float',
+      trigger_alert: 'float',
     };
 
     if (window.perspective && window.perspective.worker()) {
@@ -59,6 +56,18 @@ class Graph extends Component<IProps, {}> {
 
       // Add more Perspective configurations here.
       elem.load(this.table);
+      elem.setAttribute('view','y,line');
+      elem.setAttribute('row-pivots','["timestamp"]');
+      elem.setAttribute('columns','["ratio","lower_bound","upper_bound","trigger_alert"]');
+      elem.setAttribute('aggregates', JSON.stringify({
+        price_abc: 'avg',
+        price_def: 'avg',
+        ratio: 'avg',
+        timestamp: 'distinct count',
+        upper_bound: 'avg',
+        lower_bound: 'avg',
+        trigger_alert: 'avg',
+      }));
     }
   }
 
@@ -67,7 +76,7 @@ class Graph extends Component<IProps, {}> {
     if (this.table) {
       // As part of the task, you need to fix the way we update the data props to
       // avoid inserting duplicated entries into Perspective table again.
-      this.table.update(this.props.data.map((el: any) => {
+      /**this.table.update(this.props.data.map((el: any) => {
         // Format the data from ServerRespond to the schema
         return {
           stock: el.stock,
@@ -75,7 +84,10 @@ class Graph extends Component<IProps, {}> {
           top_bid_price: el.top_bid && el.top_bid.price || 0,
           timestamp: el.timestamp,
         };
-      }));
+      }));*/
+      this.table.update([
+          DataManipulator.generateRow(this.props.data),
+      ] as known as TableData);
     }
   }
 }
-- 
2.39.1.windows.1

